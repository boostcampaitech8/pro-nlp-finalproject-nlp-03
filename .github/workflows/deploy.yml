name: Deploy to NCP

on:
  push:
    branches:
      - feature/backend
      - feature/frontend

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: SSH Deploy
        uses: appleboy/ssh-action@master
        with:
          host: 211.188.62.72
          username: root
          key: ${{ secrets.NCP_SSH_KEY }}
          script: |
            cd ~/recipe-app/backend
            git pull origin feature/backend
            cd ~/recipe-app/frontend
            git pull origin feature/frontend
            cd ~/recipe-app
            sudo docker compose down
            sudo docker compose build --no-cache
            sudo docker compose up -d
            sudo docker compose logs backend --tail -30
